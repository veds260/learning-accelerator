<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learning Accelerator Â· Manning LLM Course</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="index.css">
</head>
<body>

  <nav class="nav">
    <a href="index.html" class="nav-brand">
      <span class="logo">âš¡</span>
      Learning Accelerator
    </a>
    <div class="nav-menu">
      <a href="index.html"         class="nav-link active">Dashboard</a>
      <a href="lessons.html"       class="nav-link">Lessons</a>
      <a href="code-playground.html" class="nav-link">Playground</a>
    </div>
  </nav>

  <div class="container">

    <!-- Hero -->
    <div class="hero reveal">
      <h1>Build Language Models</h1>
      <p class="subtitle">Story-driven Python lessons. No fluff, just understanding.</p>
    </div>

    <!-- Stats (shown after first lesson) -->
    <div class="dash-stats reveal" id="stats-section" style="display:none;">
      <div class="stat-tile">
        <span class="stat-tile-icon">ðŸ“š</span>
        <div>
          <div class="stat-tile-value" id="lessons-completed">0</div>
          <div class="stat-tile-label">Lessons done</div>
        </div>
      </div>
      <div class="stat-tile" id="xp-tile" style="display:none;">
        <span class="stat-tile-icon">âš¡</span>
        <div>
          <div class="stat-tile-value" id="xp-value">0</div>
          <div class="stat-tile-label">XP earned</div>
        </div>
      </div>
    </div>

    <!-- Next action -->
    <section class="section reveal">
      <div class="section-label" id="action-label">Start Learning</div>
      <div class="cta-card" id="cta-card" onclick="window.location.href='lessons.html'">
        <div class="cta-card-inner">
          <div class="cta-emoji" id="cta-emoji">ðŸ§©</div>
          <div class="cta-text">
            <div class="cta-title" id="cta-title">The Language Puzzle</div>
            <div class="cta-sub" id="cta-sub">How do computers read text?</div>
            <div class="cta-meta">~10 min Â· +100 XP</div>
          </div>
          <div class="cta-arrow">â†’</div>
        </div>
      </div>

      <div class="secondary-actions">
        <a href="code-playground.html" class="action-tile">
          <span>ðŸ’»</span>
          <div>
            <div class="action-tile-title">Code Playground</div>
            <div class="action-tile-sub">Free-form Python</div>
          </div>
        </a>
      </div>
    </section>

    <!-- Recent completions (shown after first lesson) -->
    <section class="section reveal" id="recent-section" style="display:none;">
      <div class="section-label">Recently Completed</div>
      <div id="recent-list"></div>
    </section>

  </div>

  <script>
    const STORAGE_KEY = 'learning-accelerator-progress';

    function loadLocalProgress() {
      try {
        const s = localStorage.getItem(STORAGE_KEY);
        return s ? JSON.parse(s) : { completedLessons: [], xp: 0 };
      } catch { return { completedLessons: [], xp: 0 }; }
    }

    // Scroll reveal
    function setupReveal() {
      const obs = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            e.target.classList.add('visible');
            obs.unobserve(e.target);
          }
        });
      }, { threshold: 0.08 });
      document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
    }

    async function loadDashboard() {
      const progress = loadLocalProgress();
      const completed = progress.completedLessons || [];
      const xp        = progress.xp || 0;

      try {
        const res     = await fetch('/api/lessons');
        const data    = await res.json();
        const lessons = Array.isArray(data) ? data : (data.lessons || []);

        // Show stats after first lesson
        if (completed.length > 0) {
          document.getElementById('stats-section').style.display = 'flex';
          document.getElementById('lessons-completed').textContent =
            `${completed.length}/${lessons.length}`;

          if (xp > 0) {
            document.getElementById('xp-tile').style.display  = 'flex';
            document.getElementById('xp-value').textContent   = xp;
          }

          // Recent completions
          const recent = lessons.filter(l => completed.includes(l.id));
          if (recent.length > 0) {
            document.getElementById('recent-section').style.display = 'block';
            document.getElementById('recent-list').innerHTML = recent.map(l => `
              <div class="completed-lesson" onclick="window.location.href='lesson-detail.html?id=${l.id}'">
                <span>${l.emoji || 'ðŸ“–'}</span>
                ${l.title}
                <span style="margin-left:auto; color:var(--success); font-size:0.85rem;">âœ“</span>
              </div>`).join('');
          }

          document.getElementById('action-label').textContent = 'Continue Learning';
        }

        // Next lesson
        const next = lessons.find(l => !completed.includes(l.id));
        if (next) {
          document.getElementById('cta-emoji').textContent = next.emoji || 'ðŸ“–';
          document.getElementById('cta-title').textContent = next.title;
          document.getElementById('cta-sub').textContent   = next.subtitle || '';
          document.getElementById('cta-card').onclick = () =>
            window.location.href = `lesson-detail.html?id=${next.id}`;
        } else {
          document.getElementById('cta-emoji').textContent = 'ðŸŽ‰';
          document.getElementById('cta-title').textContent = 'All lessons complete!';
          document.getElementById('cta-sub').textContent   = 'You finished the full foundation.';
          document.querySelector('.cta-meta').textContent  = '';
          document.getElementById('cta-card').style.cursor = 'default';
          document.getElementById('cta-card').onclick      = null;
        }
      } catch (err) {
        console.warn('Dashboard API error:', err);
        // Dashboard still works with localStorage; just skip lesson title update
      }

      setupReveal();
    }

    document.addEventListener('DOMContentLoaded', loadDashboard);
  </script>
</body>
</html>
